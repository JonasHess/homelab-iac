# External configuration chart (opt-in, leave repoURL empty to disable)
externalConfig:
  repoURL: ""
  targetRevision: "main"
  path: ""
  configMapName: "homeassistant-app-config"

generic:
  configMaps:
    homeassistant-config-map:
      TZ: "Europe/Berlin"
      PUID: "911"
      PGID: "911"
  deployment:
    image: lscr.io/linuxserver/homeassistant:2026.2.2
    ports:
    - containerPort: 8123
    pvcMounts:
      config:
        mountPath: /config
        hostPath: ~ # /mnt/somewhere/unencrypted/apps/homeassistant/config
        backup:
          enabled: true
    envFrom:
      configMapRef: homeassistant-config-map
  service:
    ports:
    - name: http
      port: 8123
  ingress:
    https:
    - subdomain: homeassistant
      port: 8123
      middlewares:
      - oauth2-proxy
    # Bypass oauth2-proxy for API, auth endpoints, and Android WebView (companion app)
    - subdomain: homeassistant
      priority: 20
      matchSuffix: '&& (PathPrefix(`/api`) || PathPrefix(`/auth`) || HeaderRegexp(`User-Agent`, `wv`))'
      port: 8123
