global:
  domain: ~ # example.com
  oauth2_proxy:
    oidc_client_id: ~ # your-cognito-client-id
    oidc_issuer_url: ~ # https://accounts.google.com
  akeyless:
    path: ~ # /path/to/secrets
additionalExposedPorts:
  sftpgo:
    port: 2222
    protocol: TCP
  ftp:
    port: 2121
    protocol: TCP
  dns:
    port: 53
    protocol: UDP
loadBalancerIP: null
generic:
  persistentVolumeClaims:
    data:
      hostPath: ~ # /mnt/somewhere/unencrypted/apps/traefik/data
      backup:
        enabled: true
middlewares:
  cloudflare:
    allowedCIDRs: []

oauth2-proxy:
  config:
    existingSecret: oauth2-proxy
  # extraArgs must be fully specified in environment-specific values (homelab_environments)
  # due to Helm's map replacement behavior (not merged, but replaced entirely)
  # Required args: provider, oidc-issuer-url, upstream, reverse-proxy, cookie-domain,
  #                cookie-samesite, cookie-secure, whitelist-domain, email-domain,
  #                redirect-url, skip-provider-button
  extraObjects:
    - apiVersion: traefik.io/v1alpha1
      kind: Middleware
      metadata:
        name: oauth2-proxy
        namespace: '{{ .Release.Namespace }}'
        annotations:
          argocd.argoproj.io/sync-options: SkipDryRunOnMissingResource=true
      spec:
        forwardAuth:
          address: http://{{ .Release.Name }}-oauth2-proxy.{{ .Release.Namespace }}.svc.cluster.local/oauth2/auth
          trustForwardHeader: true
          authResponseHeaders:
            - X-Auth-Request-User
            - X-Auth-Request-Email
    - apiVersion: traefik.io/v1alpha1
      kind: IngressRoute
      metadata:
        name: oauth2-proxy
        namespace: '{{ .Release.Namespace }}'
        annotations:
          argocd.argoproj.io/sync-options: SkipDryRunOnMissingResource=true
      spec:
        entryPoints:
          - websecure
        routes:
          - kind: Rule
            match: Host(`auth.{{ .Values.global.domain }}`)
            services:
              - name: '{{ .Release.Name }}-oauth2-proxy'
                port: 80
        tls:
          certResolver: cloudflare
