# OAuth2-Proxy External Secret
#
# Required secrets in Akeyless at {{ .Values.global.akeyless.path }}/oidc/oauth2-proxy/:
#
# 1. client_id: OIDC client ID from your identity provider (e.g., AWS Cognito, Google)
#
# 2. client_secret: OIDC client secret from your identity provider
#
# 3. cookie_secret: Used to encrypt the session cookie. MUST be exactly 16, 24, or 32 bytes.
#    Generate with one of these commands:
#
#      # 32-byte secret (recommended):
#      openssl rand -base64 32 | head -c 32
#
#      # or using /dev/urandom:
#      head -c 32 /dev/urandom | base64 | head -c 32
#
#      # or Python:
#      python3 -c "import secrets; print(secrets.token_urlsafe(32)[:32])"
#
#    IMPORTANT: Do NOT store a base64-encoded value - store the raw string directly.
#    The value must be exactly 16, 24, or 32 characters.
#
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: oauth2-proxy-es
  namespace: {{ $.Release.Namespace }}
spec:
  refreshInterval: 1h

  secretStoreRef:
    kind: SecretStore
    name: akeyless-secret-store

  target:
    name: oauth2-proxy
    creationPolicy: Owner

  data:
    - secretKey: "client-id"
      remoteRef:
        key: "{{ .Values.global.akeyless.path }}/oidc/oauth2-proxy/client_id"
    - secretKey: "client-secret"
      remoteRef:
        key: "{{ .Values.global.akeyless.path }}/oidc/oauth2-proxy/client_secret"
    - secretKey: "cookie-secret"
      remoteRef:
        key: "{{ .Values.global.akeyless.path }}/oidc/oauth2-proxy/cookie_secret"
