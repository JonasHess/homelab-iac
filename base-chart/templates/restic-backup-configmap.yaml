apiVersion: v1
kind: ConfigMap
metadata:
  name: restic-backup-paths
  namespace: {{ .Values.apps.restic.argocd.namespace | default "argocd" }}
  labels:
    app.kubernetes.io/name: restic-backup-paths
    app.kubernetes.io/component: backup
data:
  backup-paths.txt: |
{{- $backupPaths := list }}
{{- range $appName, $appConfig := .Values.apps }}
  {{- if $appConfig.enabled }}
    {{- $pvcMounts := $appConfig.argocd.helm.values.generic.deployment.pvcMounts }}
    {{- if $pvcMounts }}
      {{- range $mountName, $mountConfig := $pvcMounts }}
        {{- if and $mountConfig.backup $mountConfig.hostPath }}
          {{- $backupPaths = append $backupPaths $mountConfig.hostPath }}
        {{- end }}
      {{- end }}
    {{- end }}
  {{- end }}
{{- end }}
{{- $backupPaths = append $backupPaths .Values.apps.mealie.argocd.helm.values.generic.deployment.pvcMounts.data.backup }}
{{- $backupPaths = append $backupPaths "OK" }}
{{/*{{- $uniquePaths := $backupPaths | uniq | sortAlpha }}*/}}
{{- range $backupPaths }}
    {{ . }}
{{- end }}