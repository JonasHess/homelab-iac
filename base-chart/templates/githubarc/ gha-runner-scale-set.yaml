{{- if .Values.apps.githubarc.enabled -}}
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: gha-runner-scale-set
  namespace: argocd
spec:
  project: default
  source:
    repoURL: ghcr.io/actions/actions-runner-controller-charts
    targetRevision: "0.9.3"
    chart: gha-runner-scale-set
    helm:
      releaseName: arc-runner-set
      valuesObject:
        githubConfigUrl: "https://github.com/Hess-IT-Beratung"
        githubConfigSecret: github-arc-secret
        ## maxRunners is the max number of runners the autoscaling runner set will scale up to.
        maxRunners: 4

        ## minRunners is the min number of idle runners. The target number of runners created will be
        ## calculated as a sum of minRunners and the number of jobs assigned to the scale set.
        minRunners: 2
        containerMode:
          type: "kubernetes"
          kubernetesModeWorkVolumeClaim:
            accessModes: ["ReadWriteOnce"]
            storageClassName: "github-hostpath"
            resources:
              requests:
                storage: 2Gi
        controllerServiceAccount:
          name: arc-gha-rs-controller  # Explicitly set your service account name here
          namespace: argocd  # Ensure this matches the namespace of the service account
  destination:
    server: "https://kubernetes.default.svc"
    namespace: argocd
#   syncPolicy:
#     automated:
#       selfHeal: true
#       prune: true
{{- end -}}