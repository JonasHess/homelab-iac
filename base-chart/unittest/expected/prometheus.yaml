---
# Source: homelab-base-chart/templates/prometheus/prometheus-config-secret.yaml
apiVersion: v1
kind: Secret
metadata:
  name: prometheus-scrape-secret
  namespace: argocd
  labels:
    app: prometheus
type: Opaque
data:
  scrape-config.yaml:"LSBqb2JfbmFtZTogZHVwbGljYXRpX2JhY2t1cAogIGhvbm9yX2xhYmVsczogdHJ1ZQogIHN0YXRpY19jb25maWdzOgogICAgLSB0YXJnZXRzOiBbJ2R1cGxpY2F0aS1wcm9tZXRoZXVzLWV4cG9ydGVyLXNlcnZpY2U6NTAwMCddCi0gam9iX25hbWU6IHpmc19zdGF0dXMKICBob25vcl9sYWJlbHM6IHRydWUKICBzdGF0aWNfY29uZmlnczoKICAgIC0gdGFyZ2V0czogWyclIXMoPG5pbD4pOjkxMzQnXQo="
---
# Source: homelab-base-chart/templates/prometheus/grafana-dashboard-config-map.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: custom-dashboards
  namespace: argocd
  labels:
    grafana_dashboard: "1"
data:
  custom-dashboard.json: |-
    
    {
    	"annotations": {
    		"list": [
    			{
    				"builtIn": 1,
    				"datasource": {
    					"type": "grafana",
    					"uid": "-- Grafana --"
    				},
    				"enable": true,
    				"hide": true,
    				"iconColor": "rgba(0, 211, 255, 1)",
    				"name": "Annotations & Alerts",
    				"type": "dashboard"
    			}
    		]
    	},
    	"editable": true,
    	"fiscalYearStartMonth": 0,
    	"graphTooltip": 0,
    	"id": null,
    	"links": [],
    	"liveNow": false,
    	"panels": [
    		{
    			"datasource": {
    				"type": "prometheus",
    				"uid": "prometheus"
    			},
    			"fieldConfig": {
    				"defaults": {
    					"color": {
    						"mode": "palette-classic"
    					},
    					"custom": {
    						"axisBorderShow": false,
    						"axisCenteredZero": false,
    						"axisColorMode": "text",
    						"axisLabel": "",
    						"axisPlacement": "auto",
    						"barAlignment": 0,
    						"barWidthFactor": 0.6,
    						"drawStyle": "line",
    						"fillOpacity": 0,
    						"gradientMode": "none",
    						"hideFrom": {
    							"legend": false,
    							"tooltip": false,
    							"viz": false
    						},
    						"insertNulls": false,
    						"lineInterpolation": "linear",
    						"lineWidth": 1,
    						"pointSize": 5,
    						"scaleDistribution": {
    							"type": "linear"
    						},
    						"showPoints": "auto",
    						"spanNulls": false,
    						"stacking": {
    							"group": "A",
    							"mode": "none"
    						},
    						"thresholdsStyle": {
    							"mode": "off"
    						}
    					},
    					"mappings": [],
    					"thresholds": {
    						"mode": "absolute",
    						"steps": [
    							{
    								"color": "green",
    								"value": null
    							},
    							{
    								"color": "red",
    								"value": 80
    							}
    						]
    					},
    					"unit": "bytes"
    				},
    				"overrides": []
    			},
    			"gridPos": {
    				"h": 8,
    				"w": 12,
    				"x": 0,
    				"y": 0
    			},
    			"id": 13,
    			"interval": "1m",
    			"options": {
    				"legend": {
    					"calcs": [],
    					"displayMode": "list",
    					"placement": "bottom",
    					"showLegend": true
    				},
    				"tooltip": {
    					"mode": "single",
    					"sort": "none"
    				}
    			},
    			"pluginVersion": "11.4.0",
    			"targets": [
    				{
    					"editorMode": "code",
    					"expr": "duplicati_known_file_size{backup_name=\"$backup_name\", operation_name=\"$operation\"}",
    					"legendFormat": "current size of backup versions",
    					"range": true,
    					"refId": "A"
    				},
    				{
    					"datasource": {
    						"type": "prometheus",
    						"uid": "prometheus"
    					},
    					"editorMode": "code",
    					"expr": "duplicati_size_of_examined_files{backup_name=\"$backup_name\", operation_name=\"$operation\"}",
    					"hide": false,
    					"instant": false,
    					"legendFormat": "size of source data",
    					"range": true,
    					"refId": "B"
    				}
    			],
    			"title": "File sizes",
    			"type": "timeseries"
    		},
    		{
    			"datasource": {
    				"type": "prometheus",
    				"uid": "prometheus"
    			},
    			"fieldConfig": {
    				"defaults": {
    					"color": {
    						"mode": "thresholds"
    					},
    					"custom": {
    						"fillOpacity": 70,
    						"hideFrom": {
    							"legend": false,
    							"tooltip": false,
    							"viz": false
    						},
    						"lineWidth": 1
    					},
    					"mappings": [
    						{
    							"options": {
    								"0": {
    									"color": "dark-green",
    									"index": 0,
    									"text": "Success"
    								},
    								"1": {
    									"color": "dark-yellow",
    									"index": 1,
    									"text": "Warning"
    								},
    								"2": {
    									"color": "dark-red",
    									"index": 2,
    									"text": "Fail"
    								}
    							},
    							"type": "value"
    						}
    					],
    					"thresholds": {
    						"mode": "absolute",
    						"steps": [
    							{
    								"color": "green",
    								"value": null
    							}
    						]
    					}
    				},
    				"overrides": []
    			},
    			"gridPos": {
    				"h": 8,
    				"w": 12,
    				"x": 0,
    				"y": 0
    			},
    			"id": 12,
    			"interval": "1h",
    			"options": {
    				"colWidth": 0.9,
    				"legend": {
    					"displayMode": "list",
    					"placement": "bottom",
    					"showLegend": true
    				},
    				"rowHeight": 0.9,
    				"showValue": "auto",
    				"tooltip": {
    					"mode": "none",
    					"sort": "none"
    				}
    			},
    			"pluginVersion": "11.4.0",
    			"targets": [
    				{
    					"editorMode": "code",
    					"expr": "duplicati_ops_result{backup_name=\"$backup_name\", operation_name=\"$operation\"}",
    					"interval": "",
    					"legendFormat": " ",
    					"range": true,
    					"refId": "A"
    				}
    			],
    			"title": "Backup Success",
    			"type": "status-history"
    		},
    		{
    			"datasource": {
    				"type": "prometheus",
    				"uid": "${datasource}"
    			},
    			"fieldConfig": {
    				"defaults": {
    					"color": {
    						"mode": "thresholds"
    					},
    					"mappings": [],
    					"max": 100,
    					"min": 0,
    					"noValue": "0",
    					"thresholds": {
    						"mode": "percentage",
    						"steps": [
    							{
    								"color": "green",
    								"value": null
    							},
    							{
    								"color": "#EAB839",
    								"value": 80
    							},
    							{
    								"color": "red",
    								"value": 90
    							}
    						]
    					},
    					"unit": "percent"
    				},
    				"overrides": []
    			},
    			"gridPos": {
    				"h": 4,
    				"w": 2,
    				"x": 0,
    				"y": 0
    			},
    			"id": 1,
    			"options": {
    				"minVizHeight": 75,
    				"minVizWidth": 75,
    				"orientation": "auto",
    				"reduceOptions": {
    					"calcs": [
    						"lastNotNull"
    					],
    					"fields": "",
    					"values": false
    				},
    				"showThresholdLabels": false,
    				"showThresholdMarkers": true,
    				"sizing": "auto"
    			},
    			"pluginVersion": "11.2.0",
    			"targets": [
    				{
    					"datasource": {
    						"type": "prometheus",
    						"uid": "${datasource}"
    					},
    					"editorMode": "code",
    					"exemplar": false,
    					"expr": "topk(1, duplicati_free_quota_space{backup_name=\"$backup_name\", operation_name=\"$operation\"}) / topk(1, duplicati_total_quota_space{backup_name=\"$backup_name\", operation_name=\"$operation\"})  * 100",
    					"instant": false,
    					"legendFormat": "__auto",
    					"range": true,
    					"refId": "A"
    				}
    			],
    			"title": "Storage usage",
    			"type": "gauge"
    		},
    		{
    			"datasource": {
    				"default": false,
    				"type": "prometheus",
    				"uid": "${datasource}"
    			},
    			"fieldConfig": {
    				"defaults": {
    					"color": {
    						"mode": "thresholds"
    					},
    					"mappings": [
    						{
    							"options": {
    								"0": {
    									"color": "green",
    									"index": 0,
    									"text": "Success"
    								},
    								"1": {
    									"color": "yellow",
    									"index": 1,
    									"text": "Warning"
    								},
    								"2": {
    									"color": "red",
    									"index": 2,
    									"text": "Fail"
    								}
    							},
    							"type": "value"
    						}
    					],
    					"thresholds": {
    						"mode": "absolute",
    						"steps": [
    							{
    								"color": "green",
    								"value": null
    							},
    							{
    								"color": "red",
    								"value": 80
    							}
    						]
    					}
    				},
    				"overrides": []
    			},
    			"gridPos": {
    				"h": 4,
    				"w": 2,
    				"x": 2,
    				"y": 0
    			},
    			"id": 11,
    			"options": {
    				"colorMode": "value",
    				"graphMode": "area",
    				"justifyMode": "auto",
    				"orientation": "auto",
    				"percentChangeColorMode": "standard",
    				"reduceOptions": {
    					"calcs": [
    						"lastNotNull"
    					],
    					"fields": "",
    					"values": false
    				},
    				"showPercentChange": false,
    				"textMode": "auto",
    				"wideLayout": true
    			},
    			"pluginVersion": "11.2.0",
    			"targets": [
    				{
    					"datasource": {
    						"type": "prometheus",
    						"uid": "${datasource}"
    					},
    					"editorMode": "code",
    					"exemplar": false,
    					"expr": "topk(1, duplicati_ops_result{backup_name=\"$backup_name\", operation_name=\"$operation\"})",
    					"instant": true,
    					"legendFormat": "__auto",
    					"range": false,
    					"refId": "A"
    				}
    			],
    			"title": "Last Result",
    			"type": "stat"
    		},
    		{
    			"datasource": {
    				"type": "prometheus",
    				"uid": "${datasource}"
    			},
    			"fieldConfig": {
    				"defaults": {
    					"color": {
    						"mode": "thresholds"
    					},
    					"mappings": [],
    					"noValue": "0",
    					"thresholds": {
    						"mode": "absolute",
    						"steps": [
    							{
    								"color": "red",
    								"value": null
    							}
    						]
    					}
    				},
    				"overrides": []
    			},
    			"gridPos": {
    				"h": 4,
    				"w": 4,
    				"x": 4,
    				"y": 0
    			},
    			"id": 10,
    			"options": {
    				"colorMode": "value",
    				"graphMode": "area",
    				"justifyMode": "auto",
    				"orientation": "auto",
    				"percentChangeColorMode": "standard",
    				"reduceOptions": {
    					"calcs": [
    						"lastNotNull"
    					],
    					"fields": "",
    					"values": false
    				},
    				"showPercentChange": false,
    				"textMode": "auto",
    				"wideLayout": true
    			},
    			"pluginVersion": "11.2.0",
    			"targets": [
    				{
    					"datasource": {
    						"type": "prometheus",
    						"uid": "${datasource}"
    					},
    					"editorMode": "code",
    					"expr": "duplicati_backup_ops_total{backup_name=\"$backup_name\", result=\"Fail\", operation_name=\"$operation\"}",
    					"instant": false,
    					"legendFormat": "__auto",
    					"range": true,
    					"refId": "A"
    				}
    			],
    			"title": "Total $operation Failed [$backup_name]",
    			"type": "stat"
    		},
    		{
    			"datasource": {
    				"type": "prometheus",
    				"uid": "${datasource}"
    			},
    			"fieldConfig": {
    				"defaults": {
    					"color": {
    						"mode": "thresholds"
    					},
    					"mappings": [],
    					"thresholds": {
    						"mode": "absolute",
    						"steps": [
    							{
    								"color": "green",
    								"value": null
    							},
    							{
    								"color": "red",
    								"value": 80
    							}
    						]
    					}
    				},
    				"overrides": []
    			},
    			"gridPos": {
    				"h": 4,
    				"w": 4,
    				"x": 8,
    				"y": 0
    			},
    			"id": 9,
    			"options": {
    				"colorMode": "value",
    				"graphMode": "area",
    				"justifyMode": "auto",
    				"orientation": "auto",
    				"percentChangeColorMode": "standard",
    				"reduceOptions": {
    					"calcs": [
    						"lastNotNull"
    					],
    					"fields": "",
    					"values": false
    				},
    				"showPercentChange": false,
    				"textMode": "auto",
    				"wideLayout": true
    			},
    			"pluginVersion": "11.2.0",
    			"targets": [
    				{
    					"datasource": {
    						"type": "prometheus",
    						"uid": "${datasource}"
    					},
    					"editorMode": "code",
    					"expr": "duplicati_backup_ops_total{backup_name=\"$backup_name\", operation_name=\"$operation\", result=\"Success\"}",
    					"instant": false,
    					"legendFormat": "__auto",
    					"range": true,
    					"refId": "A"
    				}
    			],
    			"title": "Total $operation Success [$backup_name]",
    			"type": "stat"
    		},
    		{
    			"datasource": {
    				"type": "prometheus",
    				"uid": "${datasource}"
    			},
    			"fieldConfig": {
    				"defaults": {
    					"color": {
    						"mode": "palette-classic"
    					},
    					"custom": {
    						"axisBorderShow": false,
    						"axisCenteredZero": false,
    						"axisColorMode": "text",
    						"axisLabel": "",
    						"axisPlacement": "auto",
    						"barAlignment": 0,
    						"barWidthFactor": 0.6,
    						"drawStyle": "line",
    						"fillOpacity": 0,
    						"gradientMode": "none",
    						"hideFrom": {
    							"legend": false,
    							"tooltip": false,
    							"viz": false
    						},
    						"insertNulls": false,
    						"lineInterpolation": "linear",
    						"lineWidth": 1,
    						"pointSize": 5,
    						"scaleDistribution": {
    							"type": "linear"
    						},
    						"showPoints": "auto",
    						"spanNulls": false,
    						"stacking": {
    							"group": "A",
    							"mode": "none"
    						},
    						"thresholdsStyle": {
    							"mode": "off"
    						}
    					},
    					"mappings": [],
    					"thresholds": {
    						"mode": "absolute",
    						"steps": [
    							{
    								"color": "green",
    								"value": null
    							},
    							{
    								"color": "red",
    								"value": 80
    							}
    						]
    					},
    					"unit": "bytes"
    				},
    				"overrides": []
    			},
    			"gridPos": {
    				"h": 8,
    				"w": 12,
    				"x": 12,
    				"y": 0
    			},
    			"id": 4,
    			"options": {
    				"legend": {
    					"calcs": [],
    					"displayMode": "table",
    					"placement": "right",
    					"showLegend": true
    				},
    				"tooltip": {
    					"mode": "single",
    					"sort": "none"
    				}
    			},
    			"targets": [
    				{
    					"datasource": {
    						"type": "prometheus",
    						"uid": "${datasource}"
    					},
    					"editorMode": "code",
    					"expr": "duplicati_bytes_uploaded{backup_name=\"$backup_name\", operation_name=\"$operation\"}",
    					"instant": false,
    					"legendFormat": "Bytes upload",
    					"range": true,
    					"refId": "A"
    				},
    				{
    					"datasource": {
    						"type": "prometheus",
    						"uid": "${datasource}"
    					},
    					"editorMode": "code",
    					"expr": "duplicati_bytes_downloaded{backup_name=\"$backup_name\", operation_name=\"$operation\"}",
    					"hide": false,
    					"instant": false,
    					"legendFormat": "Bytes download",
    					"range": true,
    					"refId": "B"
    				}
    			],
    			"title": "$backup_name bytes I/O over time",
    			"type": "timeseries"
    		},
    		{
    			"datasource": {
    				"type": "prometheus",
    				"uid": "${datasource}"
    			},
    			"description": "Backups and restore",
    			"fieldConfig": {
    				"defaults": {
    					"color": {
    						"mode": "thresholds"
    					},
    					"mappings": [],
    					"thresholds": {
    						"mode": "absolute",
    						"steps": [
    							{
    								"color": "green",
    								"value": null
    							},
    							{
    								"color": "red",
    								"value": 80
    							}
    						]
    					}
    				},
    				"overrides": []
    			},
    			"gridPos": {
    				"h": 4,
    				"w": 4,
    				"x": 0,
    				"y": 4
    			},
    			"id": 8,
    			"options": {
    				"colorMode": "value",
    				"graphMode": "area",
    				"justifyMode": "auto",
    				"orientation": "auto",
    				"percentChangeColorMode": "standard",
    				"reduceOptions": {
    					"calcs": [
    						"lastNotNull"
    					],
    					"fields": "",
    					"values": false
    				},
    				"showPercentChange": false,
    				"textMode": "auto",
    				"wideLayout": true
    			},
    			"pluginVersion": "11.2.0",
    			"targets": [
    				{
    					"datasource": {
    						"type": "prometheus",
    						"uid": "${datasource}"
    					},
    					"editorMode": "code",
    					"expr": "sum(duplicati_backup_ops_total{backup_name=\"$backup_name\", operation_name=\"Backup\"})\n+ sum(duplicati_backup_ops_total{backup_name=\"$backup_name\", operation_name=\"Restore\"} OR on() vector(0))",
    					"instant": false,
    					"legendFormat": "__auto",
    					"range": true,
    					"refId": "A"
    				}
    			],
    			"title": "[$backup_name] total operation",
    			"type": "stat"
    		},
    		{
    			"datasource": {
    				"type": "prometheus",
    				"uid": "${datasource}"
    			},
    			"fieldConfig": {
    				"defaults": {
    					"color": {
    						"mode": "thresholds"
    					},
    					"mappings": [],
    					"thresholds": {
    						"mode": "absolute",
    						"steps": [
    							{
    								"color": "green",
    								"value": null
    							},
    							{
    								"color": "red",
    								"value": 80
    							}
    						]
    					}
    				},
    				"overrides": []
    			},
    			"gridPos": {
    				"h": 4,
    				"w": 4,
    				"x": 4,
    				"y": 4
    			},
    			"id": 3,
    			"options": {
    				"colorMode": "value",
    				"graphMode": "area",
    				"justifyMode": "auto",
    				"orientation": "auto",
    				"percentChangeColorMode": "standard",
    				"reduceOptions": {
    					"calcs": [
    						"lastNotNull"
    					],
    					"fields": "",
    					"values": false
    				},
    				"showPercentChange": false,
    				"textMode": "auto",
    				"wideLayout": true
    			},
    			"pluginVersion": "11.2.0",
    			"targets": [
    				{
    					"datasource": {
    						"type": "prometheus",
    						"uid": "${datasource}"
    					},
    					"editorMode": "code",
    					"expr": "duplicati_backup_list_count{backup_name=\"$backup_name\", operation_name=\"Backup\"}",
    					"instant": false,
    					"legendFormat": "__auto",
    					"range": true,
    					"refId": "A"
    				}
    			],
    			"title": "[$backup_name] versions",
    			"type": "stat"
    		},
    		{
    			"datasource": {
    				"type": "prometheus",
    				"uid": "${datasource}"
    			},
    			"fieldConfig": {
    				"defaults": {
    					"color": {
    						"mode": "thresholds"
    					},
    					"mappings": [],
    					"thresholds": {
    						"mode": "absolute",
    						"steps": [
    							{
    								"color": "green",
    								"value": null
    							}
    						]
    					},
    					"unit": "s"
    				},
    				"overrides": []
    			},
    			"gridPos": {
    				"h": 4,
    				"w": 4,
    				"x": 8,
    				"y": 4
    			},
    			"id": 2,
    			"options": {
    				"colorMode": "value",
    				"graphMode": "area",
    				"justifyMode": "auto",
    				"orientation": "auto",
    				"percentChangeColorMode": "standard",
    				"reduceOptions": {
    					"calcs": [
    						"lastNotNull"
    					],
    					"fields": "",
    					"values": false
    				},
    				"showPercentChange": false,
    				"textMode": "auto",
    				"wideLayout": true
    			},
    			"pluginVersion": "11.2.0",
    			"targets": [
    				{
    					"datasource": {
    						"type": "prometheus",
    						"uid": "${datasource}"
    					},
    					"editorMode": "code",
    					"expr": "topk(1, duplicati_duration{backup_name=\"$backup_name\", operation_name=\"$operation\"})",
    					"instant": false,
    					"legendFormat": "Duration",
    					"range": true,
    					"refId": "A"
    				}
    			],
    			"title": "$operation duration [$backup_name]",
    			"type": "stat"
    		},
    		{
    			"datasource": {
    				"type": "prometheus",
    				"uid": "${datasource}"
    			},
    			"fieldConfig": {
    				"defaults": {
    					"color": {
    						"mode": "palette-classic"
    					},
    					"custom": {
    						"axisBorderShow": false,
    						"axisCenteredZero": false,
    						"axisColorMode": "text",
    						"axisLabel": "",
    						"axisPlacement": "auto",
    						"barAlignment": 0,
    						"barWidthFactor": 0.6,
    						"drawStyle": "line",
    						"fillOpacity": 0,
    						"gradientMode": "none",
    						"hideFrom": {
    							"legend": false,
    							"tooltip": false,
    							"viz": false
    						},
    						"insertNulls": false,
    						"lineInterpolation": "linear",
    						"lineWidth": 1,
    						"pointSize": 5,
    						"scaleDistribution": {
    							"type": "linear"
    						},
    						"showPoints": "auto",
    						"spanNulls": false,
    						"stacking": {
    							"group": "A",
    							"mode": "none"
    						},
    						"thresholdsStyle": {
    							"mode": "off"
    						}
    					},
    					"mappings": [],
    					"thresholds": {
    						"mode": "absolute",
    						"steps": [
    							{
    								"color": "green",
    								"value": null
    							},
    							{
    								"color": "red",
    								"value": 80
    							}
    						]
    					}
    				},
    				"overrides": []
    			},
    			"gridPos": {
    				"h": 6,
    				"w": 12,
    				"x": 0,
    				"y": 8
    			},
    			"id": 7,
    			"options": {
    				"legend": {
    					"calcs": [],
    					"displayMode": "table",
    					"placement": "right",
    					"showLegend": true
    				},
    				"tooltip": {
    					"mode": "single",
    					"sort": "none"
    				}
    			},
    			"pluginVersion": "10.4.3",
    			"targets": [
    				{
    					"datasource": {
    						"type": "prometheus",
    						"uid": "${datasource}"
    					},
    					"editorMode": "code",
    					"expr": "duplicati_folders_created{backup_name=\"$backup_name\", operation_name=\"$operation\"}",
    					"instant": false,
    					"legendFormat": "Folders Created",
    					"range": true,
    					"refId": "A"
    				}
    			],
    			"title": "$backup_name folders created over time",
    			"type": "timeseries"
    		},
    		{
    			"datasource": {
    				"type": "prometheus",
    				"uid": "${datasource}"
    			},
    			"fieldConfig": {
    				"defaults": {
    					"color": {
    						"mode": "palette-classic"
    					},
    					"custom": {
    						"axisBorderShow": false,
    						"axisCenteredZero": false,
    						"axisColorMode": "text",
    						"axisLabel": "",
    						"axisPlacement": "auto",
    						"barAlignment": 0,
    						"barWidthFactor": 0.6,
    						"drawStyle": "line",
    						"fillOpacity": 0,
    						"gradientMode": "none",
    						"hideFrom": {
    							"legend": false,
    							"tooltip": false,
    							"viz": false
    						},
    						"insertNulls": false,
    						"lineInterpolation": "linear",
    						"lineWidth": 1,
    						"pointSize": 5,
    						"scaleDistribution": {
    							"type": "linear"
    						},
    						"showPoints": "auto",
    						"spanNulls": false,
    						"stacking": {
    							"group": "A",
    							"mode": "none"
    						},
    						"thresholdsStyle": {
    							"mode": "off"
    						}
    					},
    					"mappings": [],
    					"thresholds": {
    						"mode": "absolute",
    						"steps": [
    							{
    								"color": "green",
    								"value": null
    							},
    							{
    								"color": "red",
    								"value": 80
    							}
    						]
    					}
    				},
    				"overrides": []
    			},
    			"gridPos": {
    				"h": 6,
    				"w": 12,
    				"x": 12,
    				"y": 8
    			},
    			"id": 6,
    			"options": {
    				"legend": {
    					"calcs": [],
    					"displayMode": "table",
    					"placement": "right",
    					"showLegend": true
    				},
    				"tooltip": {
    					"mode": "single",
    					"sort": "none"
    				}
    			},
    			"pluginVersion": "10.4.3",
    			"targets": [
    				{
    					"datasource": {
    						"type": "prometheus",
    						"uid": "${datasource}"
    					},
    					"editorMode": "code",
    					"expr": "duplicati_files_deleted{backup_name=\"$backup_name\", operation_name=\"$operation\"}",
    					"instant": false,
    					"legendFormat": "Files deleted",
    					"range": true,
    					"refId": "A"
    				}
    			],
    			"title": "$backup_name files deleted over time",
    			"type": "timeseries"
    		},
    		{
    			"datasource": {
    				"type": "prometheus",
    				"uid": "${datasource}"
    			},
    			"fieldConfig": {
    				"defaults": {
    					"color": {
    						"mode": "palette-classic"
    					},
    					"custom": {
    						"axisBorderShow": false,
    						"axisCenteredZero": false,
    						"axisColorMode": "text",
    						"axisLabel": "",
    						"axisPlacement": "auto",
    						"barAlignment": 0,
    						"barWidthFactor": 0.6,
    						"drawStyle": "line",
    						"fillOpacity": 0,
    						"gradientMode": "none",
    						"hideFrom": {
    							"legend": false,
    							"tooltip": false,
    							"viz": false
    						},
    						"insertNulls": false,
    						"lineInterpolation": "linear",
    						"lineWidth": 1,
    						"pointSize": 5,
    						"scaleDistribution": {
    							"type": "linear"
    						},
    						"showPoints": "auto",
    						"spanNulls": false,
    						"stacking": {
    							"group": "A",
    							"mode": "none"
    						},
    						"thresholdsStyle": {
    							"mode": "off"
    						}
    					},
    					"mappings": [],
    					"thresholds": {
    						"mode": "absolute",
    						"steps": [
    							{
    								"color": "green",
    								"value": null
    							},
    							{
    								"color": "red",
    								"value": 80
    							}
    						]
    					}
    				},
    				"overrides": []
    			},
    			"gridPos": {
    				"h": 7,
    				"w": 24,
    				"x": 0,
    				"y": 14
    			},
    			"id": 5,
    			"options": {
    				"legend": {
    					"calcs": [],
    					"displayMode": "table",
    					"placement": "right",
    					"showLegend": true
    				},
    				"tooltip": {
    					"mode": "single",
    					"sort": "none"
    				}
    			},
    			"pluginVersion": "10.4.3",
    			"targets": [
    				{
    					"datasource": {
    						"type": "prometheus",
    						"uid": "${datasource}"
    					},
    					"editorMode": "code",
    					"expr": "duplicati_files_uploaded{backup_name=\"$backup_name\", operation_name=\"$operation\"}",
    					"instant": false,
    					"legendFormat": "Files upload",
    					"range": true,
    					"refId": "A"
    				},
    				{
    					"datasource": {
    						"type": "prometheus",
    						"uid": "${datasource}"
    					},
    					"editorMode": "code",
    					"expr": "duplicati_files_downloaded{backup_name=\"$backup_name\", operation_name=\"$operation\"}",
    					"hide": false,
    					"instant": false,
    					"legendFormat": "Files download",
    					"range": true,
    					"refId": "B"
    				}
    			],
    			"title": "$backup_name files upload over time",
    			"type": "timeseries"
    		}
    	],
    	"refresh": "1m",
    	"schemaVersion": 39,
    	"tags": [
    		"Backup",
    		"Duplicati"
    	],
    	"templating": {
    		"list": [
    			{
    				"current": {
    					"selected": false,
    					"text": "test-duplicati",
    					"value": "test-duplicati"
    				},
    				"datasource": {
    					"type": "prometheus",
    					"uid": "${datasource}"
    				},
    				"definition": "label_values(backup_name)",
    				"hide": 0,
    				"includeAll": false,
    				"multi": false,
    				"name": "backup_name",
    				"options": [],
    				"query": {
    					"query": "label_values(backup_name)",
    					"refId": "PrometheusVariableQueryEditor-VariableQuery"
    				},
    				"refresh": 1,
    				"regex": "",
    				"skipUrlSync": false,
    				"sort": 0,
    				"type": "query"
    			},
    			{
    				"current": {
    					"selected": true,
    					"text": "Backup",
    					"value": "Backup"
    				},
    				"datasource": {
    					"type": "prometheus",
    					"uid": "${datasource}"
    				},
    				"definition": "label_values(operation_name)",
    				"hide": 0,
    				"includeAll": false,
    				"label": "operation",
    				"multi": false,
    				"name": "operation",
    				"options": [],
    				"query": {
    					"query": "label_values(operation_name)",
    					"refId": "PrometheusVariableQueryEditor-VariableQuery"
    				},
    				"refresh": 1,
    				"regex": "",
    				"skipUrlSync": false,
    				"sort": 0,
    				"type": "query"
    			},
    			{
    				"current": {
    					"selected": false,
    					"text": "prometheus",
    					"value": "ddyar1y1798u8a"
    				},
    				"hide": 0,
    				"includeAll": false,
    				"label": "datasource",
    				"multi": false,
    				"name": "datasource",
    				"options": [],
    				"query": "prometheus",
    				"queryValue": "",
    				"refresh": 1,
    				"regex": "",
    				"skipUrlSync": false,
    				"type": "datasource"
    			}
    		]
    	},
    	"time": {
    		"from": "now-30m",
    		"to": "now"
    	},
    	"timepicker": {},
    	"timezone": "browser",
    	"title": "Duplicati Backup Dashboard",
    	"version": 2,
    	"uid": "ee7fdlyarp9mod",
    	"weekStart": ""
    }
---
# Source: homelab-base-chart/templates/_generic/pv.yaml
apiVersion: v1
kind: PersistentVolume
metadata:
  name: "prometheus-prometheus-pv"
  namespace: argocd
  labels:
    app: "prometheus-prometheus"
  annotations:
    argocd.argoproj.io/sync-options: Prune=true
spec:
  capacity:
    storage: 10Gi
  volumeMode: Filesystem
  accessModes:
    - ReadWriteOnce
# WARNING: THIS WILL DELETE THE PV AND ALL DATA INSIDE IT
  persistentVolumeReclaimPolicy: Retain
  storageClassName: ''
  hostPath:
    type: Directory
    path: /mnt/somewhere/unencrypted/apps/prometheus/data
---
# Source: homelab-base-chart/templates/_generic/pvc.yaml
apiVersion: v1
kind: PersistentVolume
metadata:
  name: "prometheus-alertmanager-pv"
  namespace: argocd
  annotations:
    argocd.argoproj.io/sync-options: Prune=true
spec:
  capacity:
    storage: 10Gi
  volumeMode: Filesystem
  accessModes:
    - ReadWriteMany
# WARNING: THIS WILL DELETE THE PV AND ALL DATA INSIDE IT
  persistentVolumeReclaimPolicy: Retain
  storageClassName: ''
  hostPath:
    type: Directory
    path: /mnt/somewhere/unencrypted/apps/prometheus/alertmanager/data
  claimRef:
    apiVersion: v1
    kind: PersistentVolumeClaim
    name: "prometheus-alertmanager-pvc"
    namespace: argocd
---
# Source: homelab-base-chart/templates/_generic/pvc.yaml
---
apiVersion: v1
kind: PersistentVolume
metadata:
  name: "prometheus-grafana-pv"
  namespace: argocd
  annotations:
    argocd.argoproj.io/sync-options: Prune=true
spec:
  capacity:
    storage: 10Gi
  volumeMode: Filesystem
  accessModes:
    - ReadWriteMany
# WARNING: THIS WILL DELETE THE PV AND ALL DATA INSIDE IT
  persistentVolumeReclaimPolicy: Retain
  storageClassName: ''
  hostPath:
    type: Directory
    path: /mnt/somewhere/unencrypted/apps/prometheus/grafana/data
  claimRef:
    apiVersion: v1
    kind: PersistentVolumeClaim
    name: "prometheus-grafana-pvc"
    namespace: argocd
---
# Source: homelab-base-chart/templates/_generic/pvc.yaml
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: "prometheus-alertmanager-pvc"
  namespace: argocd
  annotations:
    argocd.argoproj.io/sync-options: Prune=true
spec:
  storageClassName: ''
  accessModes:
    - ReadWriteMany
  resources:
    requests:
      storage: 10Gi
---
# Source: homelab-base-chart/templates/_generic/pvc.yaml
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: "prometheus-grafana-pvc"
  namespace: argocd
  annotations:
    argocd.argoproj.io/sync-options: Prune=true
spec:
  storageClassName: ''
  accessModes:
    - ReadWriteMany
  resources:
    requests:
      storage: 10Gi
---
# Source: homelab-base-chart/templates/prometheus/prometheus-application.yaml
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: kube-prometheus-stack
  namespace: argocd
  annotations:
    argocd.argoproj.io/sync-options: SkipDryRunOnMissingResource=true
spec:
  project: default
  source:
    chart: kube-prometheus-stack
    repoURL: https://prometheus-community.github.io/helm-charts
    targetRevision: 67.4.0
    helm:
      # Values file as block file
      valuesObject:
        # Default values for kube-prometheus-stack.
        # This is a YAML-formatted file.
        # Declare variables to be passed into your templates.

        ## Provide a name in place of kube-prometheus-stack for `app:` labels
        ##
        nameOverride: ""

        prometheus:
          prometheusSpec:
            replicas: 1
            storageSpec:
              volumeClaimTemplate:
                spec:
                  storageClassName: ""
                  accessModes: [ "ReadWriteOnce" ]
                  resources:
                    requests:
                      storage: 10Gi
                  selector:
                    matchLabels:
                      app: prometheus-prometheus
            additionalScrapeConfigsSecret:
              enabled: true
              name: prometheus-scrape-secret
              key: scrape-config.yaml
          persistentVolumeClaim:
            existingClaim: prometheus-prometheus-pvc

        grafana:
          defaultDashboardsTimezone: Europe/Berlin
          adminPassword: ""
          adminUser: admin
          admin:
            existingSecret: grafana-admin-credentials
            userKey: admin-user
            passwordKey: admin-password
          sidecar:
            dashboards:
              enabled: true
              label: grafana_dashboard
          persistence:
            enabled: true
            existingClaim: prometheus-grafana-pvc

#        alertmanager:
  #        persistentVolumeClaim:
    #        existingClaim: prometheus-alertmanager-pvc

  destination:
    server: "https://kubernetes.default.svc"
    namespace: argocd
  syncPolicy:
    syncOptions:
      - ServerSideApply=true
      - Prune=true
---
# Source: homelab-base-chart/templates/prometheus/prometheus-external-secret.yaml
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: prometheus-external-secret
  namespace: argocd
spec:
  refreshInterval: 1h

  secretStoreRef:
    kind: SecretStore
    name: akeyless-secret-store

  target:
    name: grafana-admin-credentials
    creationPolicy: Owner

  data:
    - secretKey: "admin-user"
      remoteRef:
        key: "/kind-homelab/o11y/grafana/admin-user"
    - secretKey: "admin-password"
      remoteRef:
        key: "/kind-homelab/o11y/grafana/admin-password"
---
# Source: homelab-base-chart/templates/_generic/ingress-https.yaml
apiVersion: traefik.io/v1alpha1
kind: IngressRoute
metadata:
  name: prometheus-https-9090-0
  namespace: argocd
  annotations:
    argocd.argoproj.io/sync-options: Prune=true,SkipDryRunOnMissingResource=true
spec:
  entryPoints:
    - websecure
  routes:
    - match: Host(`prometheus.home-server.dev`) 
      kind: Rule
      priority: 10
      services:
        - name: kube-prometheus-stack-prometheus
          port: 9090
      middlewares:
        - name: traefik-forward-auth
          namespace: argocd
  tls:
    certResolver: cloudflare
---
# Source: homelab-base-chart/templates/_generic/ingress-https.yaml
apiVersion: traefik.io/v1alpha1
kind: IngressRoute
metadata:
  name: prometheus-https-80-1
  namespace: argocd
  annotations:
    argocd.argoproj.io/sync-options: Prune=true,SkipDryRunOnMissingResource=true
spec:
  entryPoints:
    - websecure
  routes:
    - match: Host(`grafana.home-server.dev`) 
      kind: Rule
      priority: 10
      services:
        - name: kube-prometheus-stack-grafana
          port: 80
      middlewares:
        - name: traefik-forward-auth
          namespace: argocd
  tls:
    certResolver: cloudflare
